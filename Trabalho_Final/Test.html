<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Teste Trabalho Final</title>
    <link rel="stylesheet" href="css/dc.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/crossfilter.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/dc.js" charset="utf-8"></script>

</head>
<body>

  <div><h1>Total de bugs por projeto</h1>
     <div id="chartBugs_Projeto"></div>
  </div>
  <br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br>
  <div><h1>Quantidade de casos de teste X Quantidade de bugs por release</h1>
     <div id="chartTC_Bug_Release"></div>
  </div>
  <div><h1>Quantidade de casos de teste por release</h1>
     <div id="chartTC_Release"></div>
  </div>

  <div><h1>Gráfico de barras com DRE</h1>
     <div id="chartDRE_Project"></div>
  </div>

  <div><h1>Horas Estimadas X Horas Reais</h1>
     <div id="chartHoras_Release"></div>
  </div>


  <script type="text/javascript">
        // Chart Bugs por release de um determinado projeto
        var barChartBugs_Projeto = dc.barChart('#chartBugs_Projeto');
        // Gráfico para quantidade de casos de teste por release
        var barChartTC_Projeto = dc.barChart('#chartTC_Release');
        // Gráfico de linha para quantidade de casos de teste x bugs por release
        var tcBugReleaseChart = dc.compositeChart('#chartTC_Bug_Release');

        // Gráfico de barras com DRE por projeto
        var dreProjectChart = dc.barChart('#chartDRE_Project');

        // Gráfico de horas estimadas x reais por release
        var compositeHorasReleaseChart = dc.compositeChart('#chartHoras_Release');

        // Gráfico de horas estimadas
        //var horasEstimadasReleaseChart = dc.barChart('#chartHoras_Estimadas_Release');

        // Gráfico de horas reais
        //var horasReaisReleaseChart = dc.barChart('#chartHoras_Reais_Release');

        d3.json("Data_Analysis.json", function(error, data) {

          var dtgFormat = d3.time.format("%d/%m/%Y");

          data.forEach(function(d) {
                d.Release_Date = dtgFormat.parse(d.Release_Date);
          });
          //criando um crossfilter
          var facts = crossfilter(data);

          //Dimensão para projetos
          var projectDim = facts.dimension(function(d){
                return d.Project;
          });

          //Dimensão para Release
          var releaseDim = facts.dimension(function(d){
                return d.Release;
          });

          //Dimensão para Data da Release
          var dateDim = facts.dimension(function(d){
                return d.Release_Date;
          });

          //Retorna a soma de bugs por projeto
          var bugsByProjeto = projectDim.group().reduceSum(function(d){
                return d.Qnt_Bugs;
          });

          //Retorna DRE por projeto
          var dreByProjectGroup = projectDim.group().reduceSum(function(d){
            return (d.Qnt_Bugs/(d.Qnt_Bugs + d.Qnt_Bugs_Client));
          });

          //Retorna qnt de bugs de dev por data da release
          var bugsByDateReleaseGroup = dateDim.group().reduceSum(function(d){
            return d.Qnt_Bugs;
          });

          //Retorna qnt de casos de teste por data da release
          var tcByDateReleaseGroup = dateDim.group().reduceSum(function(d){
            return d.Qnt_TC_Release;
          });

          //Retorna qnt de bugs por release
          var bugsByReleaseGroup = releaseDim.group().reduceSum(function(d){
            return d.Qnt_Bugs;
          });

          //Retorna qnt de casos de teste por release
          var tcByReleaseGroup = releaseDim.group().reduceSum(function(d){
            return d.Qnt_TC_Release;
          });

          //Retorna horas estimadas release
          var horasEstimadaReleaseGroup = releaseDim.group().reduceSum(function(d){
            return d.Tempo_Estimado;
          });

          //Retorna horas reais release
          var horasReaisReleaseGroup = releaseDim.group().reduceSum(function(d){
            return d.Tempo_Real;
          });

          // Tentativa de usar o gráfico de barras multiplas com dc
          var horasEstimadasReleaseChart = dc.barChart(compositeHorasReleaseChart)
                   .group(horasEstimadaReleaseGroup)
                   .valueAccessor(function (d) {
                       return d.Tempo_Estimado;
                   });

          var horasReaisReleaseChart = dc.barChart(compositeHorasReleaseChart)
                   .group(horasReaisReleaseGroup)
                   .valueAccessor(function (d) {
                       return d.Tempo_Real;
                   });


          //Gráfico de barras com Bugs por projeto
          barChartBugs_Projeto
            .width(900).height(300)
            .margins({top: 10, right: 10, bottom: 50, left: 50})
            .dimension(projectDim)
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .barPadding(0.2)
            .group(bugsByProjeto)
            .yAxisLabel("Qnt Bugs")
            .xAxisLabel("Projetos")

          //Gráfico de barras com Casos de teste por Release
          barChartTC_Projeto
            .width(2000).height(300)
            .margins({top: 10, right: 10, bottom: 50, left: 50})
            .dimension(releaseDim)
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .barPadding(0.2)
            .group(tcByReleaseGroup)
            .yAxisLabel("Qnt Casos de Testes")
            .xAxisLabel("Releases")

          // Composite chart com a linha de TC x Bugs por release de todos os projetos
          tcBugReleaseChart
             .width(1200)
             .height(400)
             .margins({top: 50, right: 50, bottom: 25, left: 40})
             .dimension(dateDim)
             .x(d3.time.scale().domain([new Date(2017, 1, 01), new Date(2017, 12, 31)]))
             .xUnits(d3.time.days)
             .renderHorizontalGridLines(true)
             .legend(dc.legend().x(1000).y(5).itemHeight(13).gap(5))
             .brushOn(false)
             .compose([
                dc.lineChart(tcBugReleaseChart)
                          .group(bugsByDateReleaseGroup, 'Bugs')
                          .ordinalColors(['steelblue']),
                dc.lineChart(tcBugReleaseChart)
                          .group(tcByDateReleaseGroup, 'Casos de Teste')
                          .ordinalColors(['darkorange'])]);

          //Gráfico de barras com DRE (Qnt de bugs encontrados pelo time de testes/ bugs total)
          dreProjectChart
            .width(900).height(300)
            .margins({top: 10, right: 10, bottom: 50, left: 50})
            .dimension(projectDim)
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .barPadding(0.2)
            .group(dreByProjectGroup)
            .yAxisLabel("DRE")
            .xAxisLabel("Projetos")


            // Composite chart com a horas estimadas X reais
          compositeHorasReleaseChart
               .width(1200)
               .height(400)
               .margins({top: 50, right: 50, bottom: 25, left: 40})
               .dimension(releaseDim)
               .x(d3.scale.ordinal())
               .xUnits(dc.units.ordinal)
               .renderHorizontalGridLines(true)
               .legend(dc.legend().x(1000).y(5).itemHeight(13).gap(5))
               .brushOn(false)
               .compose([horasEstimadasReleaseChart, horasReaisReleaseChart]);

            //Gráfico de Horas estimadas por release
/*            horasEstimadasReleaseChart
              .width(1200).height(400)
              .margins({top: 10, right: 10, bottom: 50, left: 50})
              .dimension(releaseDim)
              .x(d3.scale.ordinal())
              .xUnits(dc.units.ordinal)
              .barPadding(0.2)
              .group(horasEstimadaReleaseGroup)
              .yAxisLabel("Horas")
              .xAxisLabel("Release")

            //Gráfico de Horas estimadas por release
            horasReaisReleaseChart
              .width(1200).height(400)
              .margins({top: 10, right: 10, bottom: 50, left: 50})
              .dimension(releaseDim)
              .x(d3.scale.ordinal())
              .xUnits(dc.units.ordinal)
              .barPadding(0.2)
              .group(horasReaisReleaseGroup)
              .yAxisLabel("Horas")
              .xAxisLabel("Release")
*/



          dc.renderAll();

		});
	</script>
</body>
</html>
